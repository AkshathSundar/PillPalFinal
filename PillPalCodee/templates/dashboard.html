{% extends "base.html" %}

{% block title %}Dashboard - PillPal{% endblock %}

{% block content %}
<style>
  /* Highlight due reminders with bright yellow border and background */
  .due-reminder {
    border: 3px solid #fbbf24 !important;  /* bright yellow */
    background-color: #fffbeb !important;  /* light yellow */
    box-shadow: 0 0 10px #fbbf24;
  }
</style>

<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="display-6">
                <img src="https://i.pinimg.com/originals/d9/bc/d7/d9bcd704d3dd9929700ad2d544f820ff.jpg" alt="üåªüåû" width="40" class="me-2">
                Hello, {{ user.name }}!
            </h1>
            <div>
                <a href="{{ url_for('add_reminder') }}" class="btn btn-primary btn-lg rounded-pill me-2">
                    <i class="fas fa-plus me-2"></i>Add Reminder
                </a>
                <a href="{{ url_for('upload_voice') }}" class="btn btn-outline-primary btn-lg rounded-pill">
                    <i class="fas fa-microphone me-2"></i>Upload Voice
                </a>
            </div>
        </div>
    </div>
</div>

{% if due_reminders %}
<!-- Persistent notification banner -->
<div id="due-notification" class="alert alert-warning alert-dismissible fade show" role="alert" style="font-weight: bold; font-size: 1.2rem;">
    ‚ö†Ô∏è You have medication reminders <strong>due now</strong>! Please take them. If not, in 4 hours, we will notify {{ user.caretaker_number }}.
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<!-- Today's Reminders -->
<div class="row">
    <div class="col-12">
        <div class="card shadow rounded-4">
            <div class="card-header bg-primary text-white rounded-top-4">
                <h3 class="card-title mb-0">
                    <i class="fas fa-clock me-2"></i>Today's Medication Reminders
                </h3>
            </div>
            <div class="card-body">
                {% if reminders %}
                    <div class="row g-3">
                        {% for reminder in reminders %}
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 rounded-4 shadow {% if reminder.is_due and not reminder.taken %}due-reminder{% elif reminder.taken %}border-success{% endif %}">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <h5 class="card-title text-primary">{{ reminder.medication_name }}</h5>
                                        {% if reminder.taken %}
                                            <span class="badge bg-success fs-6">
                                                <i class="fas fa-check me-1"></i>Taken
                                            </span>
                                        {% elif reminder.is_due %}
                                            <span class="badge bg-warning fs-6">
                                                <i class="fas fa-exclamation me-1"></i>Due Now
                                            </span>
                                        {% endif %}
                                    </div>
                                    <p class="card-text fs-5"><strong>Dosage:</strong> {{ reminder.dosage }}</p>
                                    <p class="card-text fs-5"><strong>Time:</strong> {{ reminder.time_display }}</p>
                                    {% if reminder.voice_file_id %}
                                        {% for voice_file in voice_files %}
                                            {% if voice_file.id == reminder.voice_file_id %}
                                                <p class="card-text fs-6 text-muted">
                                                    <i class="fas fa-volume-up me-1"></i>Voice: {{ voice_file.name }}
                                                </p>
                                                <div class="mb-3">
                                                    <audio controls class="w-100">
                                                        <source src="{{ url_for('play_voice', voice_file_id=voice_file.id) }}" type="audio/mpeg">
                                                        Your browser does not support the audio element.
                                                    </audio>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    <div class="d-grid gap-2">
                                        {% if not reminder.taken %}
                                            <a href="{{ url_for('mark_taken', reminder_id=reminder.id) }}" 
                                               class="btn btn-success btn-lg rounded-pill"
                                               onclick="return confirm('Mark this medication as taken?')">
                                                <i class="fas fa-check me-2"></i>Mark as Taken
                                            </a>
                                        {% endif %}
                                        <a href="{{ url_for('delete_reminder', reminder_id=reminder.id) }}" 
                                           class="btn btn-outline-danger rounded-pill"
                                           onclick="return confirm('Are you sure you want to delete this reminder?')">
                                            <i class="fas fa-trash me-2"></i>Delete
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <img src="https://static.vecteezy.com/system/resources/previews/010/883/337/original/cute-happy-pill-cartoon-character-free-png.png" alt="No reminders for now! Yay!" width="100" class="mb-3">
                        <h4 class="text-muted">No medication reminders set up yet</h4>
                        <p class="fs-5 text-muted mb-4">Get started by adding your first medication reminder.</p>
                        <a href="{{ url_for('add_reminder') }}" class="btn btn-primary btn-lg rounded-pill">
                            <i class="fas fa-plus me-2"></i>Add Your First Reminder
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Voice Files Section -->
{% if voice_files %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow rounded-4">
            <div class="card-header bg-info text-white rounded-top-4">
                <h3 class="card-title mb-0">
                    <i class="fas fa-microphone me-2"></i>Your Voice Recordings
                </h3>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    {% for voice_file in voice_files %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card rounded-4">
                            <div class="card-body">
                                <h6 class="card-title">{{ voice_file.name }}</h6>
                                <p class="card-text text-muted fs-6">
                                    Uploaded: {{ voice_file.uploaded_at[:10] }}
                                </p>
                                <audio controls class="w-100">
                                    <source src="{{ url_for('play_voice', voice_file_id=voice_file.id) }}" type="audio/mpeg">
                                    Your browser does not support the audio element.
                                </audio>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
